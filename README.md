# Adding New Miro Boards

## Prerequisites
- A Miro account with access to the board you want to add
- The Board ID of your Miro board (found in the board's URL: `https://miro.com/app/board/YOUR_BOARD_ID=`)
- OAuth token for the board (if not using the default board)
- OpenAI API key (for GPT-4 model access)
- Anthropic API key (for Claude model access, optional)

## Method 1: Using Environment Variables (Recommended for Development)

1. Open your `.env` file in the project root
2. Add or update the following variables:
```env
NEXT_PUBLIC_MIRO_OAUTH_TOKEN="your_oauth_token"
NEXT_PUBLIC_MIRO_BOARD_ID="your_board_id"
OPENAI_API_KEY="your_openai_api_key"
ANTHROPIC_API_KEY="your_anthropic_api_key" # Optional, only needed for Claude model
```
3. Restart your development server
4. The application will automatically connect to the specified board

## Designer Role Play Options

The designer role play feature offers two AI model options with different strengths:

### GPT-4 (Balanced)
- Provides well-structured, consistent design thinking
- Excellent for methodical problem-solving approaches
- Balances analytical and creative thinking

### Claude (Creative)
- Offers more explorative and creative design approaches
- May generate more novel or unexpected insights
- Better for open-ended or innovative design challenges

To use these options:
1. Select your preferred model from the dropdown in the designer role play section
2. Click "Role Play Designer"
3. View the thinking process in the "Thinking-Dialogue" frame
4. Review design decisions in the "Design-Proposal" frame

### Claude 3.7 Extended Thinking

When using the Claude option, the system will exclusively use Claude 3.7 Sonnet with the extended thinking feature. This provides:

- Detailed visibility into Claude's reasoning process
- Step-by-step breakdown of how it approaches the design challenge
- More transparent explanation of design decisions and tradeoffs
- Deeper insights into the AI's problem-solving methodology

The extended thinking appears in the "Thinking-Dialogue" frame, while the final design decisions appear in the "Design-Proposal" frame. This separation helps distinguish between the AI's reasoning process and its final recommendations.

**Technical Note**: The Claude 3.7 API requires the `thinking` parameter to be passed as an object with two required fields: `{ type: 'enabled', budget_tokens: 4000 }`. The `type` field must be set to 'enabled' and the `budget_tokens` field determines the maximum tokens allocated for the thinking process.

Additionally, when using extended thinking, the `max_tokens` parameter must always be greater than the `budget_tokens` value. In our implementation, we set `max_tokens: 8000` and `budget_tokens: 4000` to satisfy this requirement while providing sufficient space for both reasoning and final response content.

The thinking content is returned in the response's `content` array as blocks with `type: 'thinking'`. These blocks contain their thinking content in the `thinking` property (not the `text` property), and also include a `signature` field that verifies the content was generated by Claude. These thinking blocks need to be extracted and processed separately from the standard text content blocks (which have `type: 'text'`).

## Troubleshooting Claude Integration

If you experience issues with the Claude option:

1. **API Key**: Verify your Anthropic API key is correct and starts with `sk-ant-`
2. **API Key Format**: Make sure your API key is properly added to your `.env` file without any extra spaces
3. **Authentication**: If you see a 401 error, your API key may be invalid or expired
4. **Access**: If you see a 403 error, your API key may not have access to the Claude 3.7 Sonnet model
5. **Model Name**: If you see a 404 "not found" error with message "model: ...", make sure you're using the correct model name format - we use `claude-3-7-sonnet-20250219` which includes the version date
6. **Rate Limits**: A 429 error indicates you've exceeded your Anthropic API rate limits
7. **Service Availability**: 500-level errors often indicate temporary issues with the Claude API itself
8. **Validation Errors**: If you see validation errors about:
   - `thinking.type`: Make sure you're passing the correct `type` field in the thinking parameter
   - `thinking.budget_tokens`: Ensure you're setting the token budget in the thinking parameter
   - `max_tokens must be greater than`: Check that your max_tokens is greater than budget_tokens
   - Content extraction errors: The implementation extracts thinking content from blocks with `type: 'thinking'`

### Claude API Best Practices

The Claude API has specific formatting requirements:

1. **Proper Message Structure**: Messages must be formatted as objects with proper `role` and `content` structure
2. **Content Array Format**: The content field should be an array of content blocks with type specifications
   ```json
   { 
     "role": "user", 
     "content": [
       {
         "type": "text",
         "text": "Your message here"
       }
     ]
   }
   ```
3. **Extended Thinking Format**: When using the thinking feature, use the proper structure:
   ```json
   { 
     "thinking": {
       "type": "enabled",
       "budget_tokens": 4000
     },
     "max_tokens": 8000
   }
   ```
4. **Thinking Block Structure**: The API returns thinking content in the following format:
   ```json
   {
     "type": "thinking",
     "thinking": "Let me analyze this step by step...",
     "signature": "WaUjzkypQ2mUEVM36O2TxuC06KN8xyfbJwyem2dw3URve/op91XWHOEBLLqIOMfFG/UvLEczmEsUjavL...."
   }
   ```
5. **Token Limits**: Claude has limits on the number of tokens per request:
   - Tier 1: 50 requests/minute, 40,000 input tokens/minute, 8,000 output tokens/minute
   - Higher tiers have increased limits

6. **Error Handling**: Implement robust error handling to catch validation errors, which are common when working with the Claude API

## Method 2: Using the UI (For Additional Boards)

1. If no board is connected, you'll see the "Add Another Board" section
2. Find your Board ID from the Miro board URL
   - Open your Miro board
   - Copy the ID from the URL (e.g., `uXjVNzqQxNs=` from `https://miro.com/app/board/uXjVNzqQxNs=/`)
3. Enter the Board ID in the input field
4. Click "Add Board"
5. Click the "Login to Board" button that appears
6. Authorize the application in the Miro popup
7. The board will be added to your application

## Board Requirements

Your Miro board should have the following frames:
- `Design-Proposal`: For design decision sticky notes
- `Analysis-Response`: For analysis responses
- `Sketch-Reference`: For design sketches and images

## Troubleshooting

If you encounter issues:
1. Ensure your OAuth token is valid and has the correct permissions
2. Check that the Board ID is correct and the board exists
3. Clear your browser cache and local storage
4. Restart the development server
5. Ensure you have the necessary permissions on the Miro board

## Security Notes

- Keep your OAuth tokens secure and never commit them directly to the repository
- Use environment variables for sensitive information
- Regularly rotate OAuth tokens for security
- Consider using different tokens for development and production environments 